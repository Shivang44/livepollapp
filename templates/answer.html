<!DOCTYPE html>
<html>
      <head>
        <meta charset="UTF-8">
        <title>{{ title }}</title>
        <link rel="stylesheet" href="https://bootswatch.com/journal/bootstrap.min.css" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
        <style>
            ul {
                padding: 0;
            }
            ul li {
                list-style-type: none;
                margin-bottom: 10px;
            }
            .letter_span {
                padding-right: 15px;
            }
            .button_choice {
                width: 200px;
            }
            .vcenter {
                min-height: 100%;  /* Fallback for browsers do NOT support vh unit */
                min-height: 100vh; /* These two lines are counted as one :-)       */
                display: flex;
                align-items: center;
            }
            .center_block {
                display: block;
                margin-left: auto;
                margin-right: auto;
                text-align: center;
                width: 100%;
            }
            .btn-success, .btn-primary {
                border: none;
            }
            .btn-success:focus{
                background-color: #22B24C;
            }
            h1 {
                font-size: 3.5em;
            }
            @media (min-width: 992px) {
                .container {
                    max-width: 750px;
                }
            }
            @media (min-width: 1200px) {
                .container {
                    max-width: 750px;
                }
            }
        </style>
      </head>
      <body>
          <div class="container">
              <div class="row">
                  <div class="col-xs-12 vcenter">
                      <div class="center_block">
                           <h1 style="margin-bottom: 25px;">{{ poll_obj.question }}</h1>
                               <ul id="answerul">
                                   {{#each poll_obj.options }}
                                   <li><button class="btn btn-primary btn-lg button_choice" value="{{ @index }}" data-selected="0">{{ this }}</button></li>
                                   {{/each}}
                             </ul>
                      </div>
                  </div>
              </div>
          </div>
         <!-- <div class="wrapper">
              <div class="content">
                      <h1 style="margin-bottom: 25px;">{{ poll_obj.question }}</h1>
                      <div class="answer">
                          <ul id="answerul">
                              {{#each poll_obj.options }}
                              <li><button class="btn btn-primary button_choice" value="{{ @index }}" data-selected="0">{{ this }}</button></li>
                              {{/each}}
                        </ul>
                  </div>
            </div>
        </div>-->
      </body>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-rc1/jquery.min.js"></script>
      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <script>
        $(document).ready(function() {
            // Add letter choice to text choice
            var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
            var index = 0;
            $('button').each(function(el){
                $(this).before("<span class='letter_span'>" + alphabet[index] + "</span>");
                index++;
            });

            // Answer poll
            var socket = io();
            var previous_button;
            $('button').click(function(){
                if (typeof previous_button === "undefined") {
                    previous_button = $(this).val();
                }
                // Add green background if selected
                // Keep a data-selected to know if we're selecting or deselecting

                var selected = $(this).data('selected');
                $('button').not(this).removeClass('btn-success').addClass('btn-primary');
                $('button').not(this).data('selected', 0);
                $(this).data('selected', (selected === 0) ? 1 : 0);

                // Emit the selected option to the 'poll:answer' channel with the poll_id and selected option
                var answer_information = {
                    poll_id: window.location.pathname.substr(1),
                    answer: $(this).val(),
                    vote_type: 'set'
                };

                if (selected === 1 ) {
                    answer_information.vote = -1;
                    $(this).removeClass('btn-success').addClass('btn-primary');
                } else {
                    answer_information.vote = 1;
                    //$(this).css('background-color', 'green');
                    $(this).removeClass('btn-primary').addClass('btn-success');
                }

                if (previous_button != $(this).val()) {
                    var answer_information_prev = {
                        poll_id: window.location.pathname.substr(1),
                        answer: previous_button,
                        vote: -1,
                        vote_type: 'unset'
                    };
                    socket.emit('poll:answers', JSON.stringify(answer_information_prev));
                }

                socket.emit('poll:answers', JSON.stringify(answer_information));
                previous_button = $(this).val();
            });
        });
      </script>
</html>
