<!DOCTYPE html>
<html>
      <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ title }}</title>
        <style>
            .section {
                margin: 10px;
            }

            .pace {
          -webkit-pointer-events: none;
          pointer-events: none;

          -webkit-user-select: none;
          -moz-user-select: none;
          user-select: none;
        }

        .pace-inactive {
          display: none;
        }

        .pace .pace-progress {
          background: #E53C37;
          position: fixed;
          z-index: 2000;
          top: 0;
          right: 100%;
          width: 100%;
          height: 2px;
        }
        </style>
        <link rel="stylesheet" href="https://bootswatch.com/journal/bootstrap.min.css" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
        <script src="https://cdn.rawgit.com/HubSpot/pace/v1.0.0/pace.min.js"></script>
      </head>
      <body>
          <div class="container">
              <div style="text-align:center;">
                <h3>Share this url so people can answer your poll: <a href="/{{poll_obj.poll_id}}">qpoll.io/{{poll_obj.poll_id}}</a> </h3>
                <h1>{{ poll_obj.question }}</h1>
                <p id="results"></p>
                <canvas id="myChart" width="100%" height="70vh"></canvas>
            </div>
        </div>
      </body>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-rc1/jquery.min.js"></script>      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.min.js"></script>
      <script>
        // Chartjs

        var ctx = $('#myChart');
        var chartConf = {
            type: 'bar',
            data: {
                labels: [
                    {{#each poll_obj.options }}
                    "{{this}}",
                    {{/each}}
                ],
                datasets: [{
                    label: 'Poll Results',
                    data: [
                        {{#each poll_obj.options }}
                        0,
                        {{/each}}
                    ],
                    backgroundColor: [
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                        'rgba(235,104,100,1)',
                    ]
                }]
            },
            options: {
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true,
                            stepSize: 1,
                            callback: function (tickValue, index, ticks) {
                                if(!(index % parseInt(ticks.length / 5))) {
                                    return tickValue;
                               }
                            }

                        }
                    }]
                }
            }
        }
        var myChart = new Chart(ctx, chartConf);
        Chart.defaults.global.defaultFontSize = 18;

        var socket = io();
        var poll_id = window.location.pathname.substr(-5);

        // Ask to view responses for specified poll_id (this will set up redis sub)
        socket.emit('poll:view:responses', poll_id);

        // Update chart as the data flows in
        socket.on('poll:' + poll_id + ':answers', function(msg) {
            for (var i = 0; i < Object.keys(msg).length; i++) {
                chartConf.data.datasets[0].data[i] = parseInt(msg[i]);
            }
            myChart.update();
        });



      </script>
</html>
