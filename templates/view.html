<!DOCTYPE html>
<html>
      <head>
        <meta charset="UTF-8">
        <title>{{ title }}</title>
        <style>
            .section {
                margin: 10px;
            }
        </style>
      </head>
      <body>
          <div style="text-align:center;">
            <h3>Share this url so people can answer your poll: <a href="/{{poll_obj.poll_id}}">domain.com/{{poll_obj.poll_id}}</a> </h3>
            <h1>{{ poll_obj.question }}</h1>
            <h3>Results: </h3>
            <p id="results"></p>
            <canvas id="myChart" width="400" height="150"></canvas>
        </div>
      </body>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-rc1/jquery.min.js"></script>      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.min.js"></script>
      <script>
        // Chartjs
        var ctx = $('#myChart');
        var chartConf = {
            type: 'bar',
            data: {
                labels: [
                    {{#each poll_obj.options }}
                    "{{this}}",
                    {{/each}}
                ],
                datasets: [{
                    label: '# of Votes',
                    data: [
                        {{#each poll_obj.options }}
                        0,
                        {{/each}}
                    ],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        }
        var myChart = new Chart(ctx, chartConf);

        var socket = io();
        var poll_id = window.location.pathname.substr(-5);

        // Ask to view responses for specified poll_id (this will set up redis sub)
        socket.emit('poll:view:responses', poll_id);

        // Update chart as the data flows in
        socket.on('poll:' + poll_id + ':answers', function(msg) {
            for (var i = 0; i < Object.keys(msg).length; i++) {
                chartConf.data.datasets[0].data[i] = parseInt(msg[i]);
            }
            myChart = new Chart(ctx, chartConf);
            console.log(chartConf.data.datasets[0].data);
        });



      </script>
</html>
